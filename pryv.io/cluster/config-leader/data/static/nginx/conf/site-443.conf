upstream follower_server {
  server config-follower:6000;
}

# Static Web
server {
  listen               443 ssl;
  server_name          sw.DOMAIN;
  access_log           /app/log/sw.access.log;

  client_max_body_size 5M;

  ### Proxy options (has to be within server definition to be effective)
  proxy_set_header  Host $http_host;
  proxy_set_header  X-Real-IP  $remote_addr;
  proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header  X-Forwarded-Proto https;
  proxy_redirect    off;
  # Buffering
  proxy_buffering off;
  proxy_buffers 16 8k;

  # Config-follower
  location /notify {
    proxy_pass http://follower_server;
  }

  # App-web-auth 3:
  # All access calls are handled by index.html, except for static assets
  if ($request_uri !~* "^/access/static/.*$") {
    rewrite ^.*$ /access/index.html;
  }

  location /access/ {
      proxy_pass        https://pryv.github.io/app-web-auth3/;
      proxy_set_header  Host 'pryv.github.io';
  }

}
