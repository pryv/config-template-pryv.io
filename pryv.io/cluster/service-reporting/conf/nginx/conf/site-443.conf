upstream reporting_server {
  server reporting:4000 max_fails=3 fail_timeout=30s;
}

# Reporting
server {
  listen                443 ssl;
  server_name           *.DOMAIN;
  access_log            /app/log/reporting.log;

  client_max_body_size  20M;
  
  ### Proxy options (has to be within server definition to be effective)
  # This enables websocket support
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection "upgrade";
  proxy_set_header X-Real-IP  $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto https;
  proxy_redirect off;
  # Buffering
  proxy_buffering off;
  proxy_buffers 16 8k;
  # User information will be in the host, so proxy that as well.
  set $my_host      $http_host;
  proxy_set_header  Host $my_host;
}
